<div class="padded" id="comments-section">
  <p><strong>{{this.commentsTotal}} Comments</strong></p>

  {{#if this.me.isAuthenticated}}
    <div class="d-flex align-items-center">
      {{#if this.me.profileUri}}
        <img alt="profile" class="mr-3 rounded-circle" width="30px" src={{this.me.profileUri}}>
      {{else}}
        <img alt="profile" class="mr-3 rounded-circle" width="30px" src="/uploads/images/profile-placeholder.gif">
      {{/if}}
      <small>You are commenting publicly as {{this.me.name}}</small>
    </div>
    <BsForm @model={{this.commentModel}} @onSubmit={{this.saveComment}} as |form|>
      <form.element @controlType="textarea" @label="Comment" @placeholder="Add a comment" @property="comment"/>
      {{#each this.commentModel.errors as |err| }}
        {{#if (eq err.key "comment")}}
          <BsAlert @type="danger" @fade={{true}}>
            {{err.message}}
          </BsAlert>
        {{/if}}
      {{/each}}
      <BsButton @type="primary" @defaultText="Comment" @buttonType="submit"/>
    </BsForm>
  {{/if}}
</div>

{{#each @chapterComments as |item|}}
  <div id="comments" class="media mt-4">
    {{#if item.creator.profileUri}}
      <img alt="profile" class="mr-3 rounded-circle" width="40px" src={{item.creator.profileUri}}>
    {{else}}
      <img alt="profile" class="mr-3 rounded-circle" width="40px" src="/uploads/images/profile-placeholder.gif">
    {{/if}}
    <div class="media-body">
      <p class="mt-2"><strong>{{item.creator.username}}</strong></p>
      {{nl2br item.comment}}

      <Reply-Section @comment={{item}} @selectedChapter={{@selectedChapter}} @chapterReplies={{@chapterReplies}}/>
    </div>
    <hr>
  </div>
{{/each}}